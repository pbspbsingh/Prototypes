<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<div id="amzn_assoc_ad_div_2">
<style type="text/css">
#__mobileAssociatesSearchWidget_pl_test_tryitout_1.__mobile-associates-search-widget,#__mobileAssociatesSearchWidget_pl_test_tryitout_1.__mobile-associates-search-widget *
	{
	margin: 0;
	padding: 0;
	border: 0;
	font-size: 12px;
	font: inherit;
	vertical-align: middle;
	font-family: arial, verdana, helvetica, sans-serif;
	position: relative;
	color: #333;
}

#__mobileAssociatesSearchWidget_pl_test_tryitout_1 {
	width: 99%;
	height: auto;
	display: inline-block;
	text-align: left;
	vertical-align: middle;
}

#__mobileAssociatesSearchWidget_pl_test_tryitout_1.__mobile-associates-search-widget .__ma-sw-category-selection
	{
	position: absolute;
	right: 10px;
	top: 25px;
	z-index: 1000;
	padding: 5px 0;
	margin: 2px 0 0;
	background-color: #fff;
	border: 1px solid #ccc;
	border: 1px solid rgba(0, 0, 0, .15);
	border-radius: 4px;
	box-shadow: 0 6px 12px rgba(0, 0, 0, .175);
	-webkit-box-shadow: 0 6px 12px rgba(0, 0, 0, .175);
	background-clip: padding-box;
}

#__mobileAssociatesSearchWidget_pl_test_tryitout_1.__mobile-associates-search-widget .__ma-sw-category-selection ul.__ma-sw-category-items
	{
	display: block;
	width: 200px;
	height: 230px;
	overflow-y: scroll;
	list-style: none;
}

#__mobileAssociatesSearchWidget_pl_test_tryitout_1.__mobile-associates-search-widget .__ma-sw-category-selection ul.__ma-sw-category-items::-webkit-scrollbar
	{
	-webkit-appearance: none;
	width: 7px;
}

#__mobileAssociatesSearchWidget_pl_test_tryitout_1.__mobile-associates-search-widget .__ma-sw-category-selection ul.__ma-sw-category-items::-webkit-scrollbar-thumb
	{
	border-radius: 4px;
	background-color: rgba(0, 0, 0, .5);
	-webkit-box-shadow: 0 0 1px rgba(255, 255, 255, .5);
}

#__mobileAssociatesSearchWidget_pl_test_tryitout_1.__mobile-associates-search-widget .__ma-sw-category-selection ul.__ma-sw-category-items li
	{
	cursor: pointer;
	display: list-item;
	text-align: left;
	text-align: -webkit-match-parent;
	list-style: none;
	font-size: 13px;
	padding: 3px 20px;
	clear: both;
	font-weight: 400;
	line-height: 1.42857143;
	color: #333;
	white-space: nowrap;
	overflow: hidden;
	text-overflow: ellipsis;
}

#__mobileAssociatesSearchWidget_pl_test_tryitout_1.__mobile-associates-search-widget .__ma-sw-category-selection ul.__ma-sw-category-items li:after,#__mobileAssociatesSearchWidget_pl_test_tryitout_1.__mobile-associates-search-widget .__ma-sw-category-selection ul.__ma-sw-category-items li:before
	{
	box-sizing: border-box;
	-webkit-box-sizing: border-box;
	-moz-box-sizing: border-box;
}

#__mobileAssociatesSearchWidget_pl_test_tryitout_1.__mobile-associates-search-widget .__ma-sw-category-selection ul.__ma-sw-category-items li.current
	{
	background: #eee;
}

#__mobileAssociatesSearchWidget_pl_test_tryitout_1 ul.__ma-sw-category-items li.outline
	{
	background: #F8F8F8;
}

#__mobileAssociatesSearchWidget_pl_test_tryitout_1.__mobile-associates-search-widget .__ma-sw-category-selection ul.__ma-sw-category-items li:hover
	{
	color: #262626;
	background-color: #F8F8F8;
}

#__mobileAssociatesSearchWidget_pl_test_tryitout_1.__mobile-associates-search-widget .__ma-sw-suggestion-wrapper
	{
	width: 99%;
	position: absolute;
	z-index: 9999;
	top: 68px;
	text-align: left;
}

#__mobileAssociatesSearchWidget_pl_test_tryitout_1.__mobile-associates-search-widget .__ma-sw-autcomplete
	{
	background: #fff;
	display: none;
	width: 100%;
	height: auto;
	border: 1px solid #ccc;
	border: 1px solid rgba(0, 0, 0, .15);
	border-radius: 0 0 4px 4px;
	box-shadow: 0 6px 12px rgba(0, 0, 0, .175);
	-webkit-box-shadow: 0 6px 12px rgba(0, 0, 0, .175);
	background-clip: padding-box;
}

#__mobileAssociatesSearchWidget_pl_test_tryitout_1.__mobile-associates-search-widget .__ma-sw-autcomplete .__ma-sw-suggestion
	{
	padding: 3px 5px;
	font-size: 12px;
	color: #333;
}

#__mobileAssociatesSearchWidget_pl_test_tryitout_1.__mobile-associates-search-widget .__ma-sw-autcomplete .__ma-sw-suggestion .cat-wrapper
	{
	color: #a9a9a9;
	cursor: default;
}

#__mobileAssociatesSearchWidget_pl_test_tryitout_1.__mobile-associates-search-widget .__ma-sw-autcomplete .__ma-sw-suggestion:last-child
	{
	border-radius: 0 0 4px 4px;
}

#__mobileAssociatesSearchWidget_pl_test_tryitout_1.__mobile-associates-search-widget .__ma-sw-autcomplete .__ma-sw-suggestion.selected
	{
	background: #eee;
	border: none;
}
</style>
	<div id="__mobileAssociatesSearchWidget_pl_test_tryitout_1" class="__mobile-associates-search-widget">
		<div class="__ma-sw-category-selection" style="display: none;">
			<ul class="__ma-sw-category-items">
				<li data-value="aps" data-search="All" data-index="0">Amazon.com</li>
				<li data-value="amazontv" data-search="UnboxVideo" data-index="1">Amazon Instant Video</li>
				<li data-value="apparel" data-search="Apparel" data-index="2" class="current">Apparel &amp; Accessories</li>
				<li data-value="appliances" data-search="Appliances" data-index="3">Appliances</li>
				<li data-value="arts-crafts" data-search="ArtsAndCrafts" data-index="4">Arts, Crafts &amp; Sewing</li>
				<li data-value="automotive" data-search="Automotive" data-index="5">Automotive</li>
				<li data-value="baby-products" data-search="Baby" data-index="6">Baby</li>
				<li data-value="beauty" data-search="Beauty" data-index="7">Beauty</li>
				<li data-value="stripbooks" data-search="Books" data-index="8">Books</li>
				<li data-value="photo" data-search="Photo" data-index="9">Camera &amp; Photo</li>
				<li data-value="mobile" data-search="Wireless" data-index="10">Cell Phones &amp; Accessories</li>
				<li data-value="classical" data-search="Classical" data-index="11">Classical Music</li>
				<li data-value="pc-hardware" data-search="PCHardware" data-index="12">Computers</li>
				<li data-value="dvd" data-search="DVD" data-index="13">DVD</li>
				<li data-value="electronics" data-search="Electronics" data-index="14">Electronics</li>
				<li data-value="na-collectibles-us" data-search="Collectibles" data-index="15">Entertainment Collectibles</li>
				<li data-value="videogames" data-search="VideoGames" data-index="16">Game Downloads</li>
				<li data-value="gift-cards" data-search="GiftCards" data-index="17">Gift Cards</li>
				<li data-value="grocery" data-search="Grocery" data-index="18">Grocery &amp; Gourmet Food</li>
				<li data-value="garden" data-search="HomeGarden" data-index="19">Home &amp; Garden</li>
				<li data-value="hpc" data-search="HealthPersonalCare" data-index="20">Health &amp; Personal Care</li>
				<li data-value="industrial" data-search="Industrial" data-index="21">Industrial &amp; Scientific</li>
				<li data-value="jewelry" data-search="Jewelry" data-index="22">Jewelry</li>
				<li data-value="digital-text" data-search="KindleStore" data-index="23">Kindle Store</li>
				<li data-value="kitchen" data-search="Kitchen" data-index="24">Kitchen &amp; Housewares</li>
				<li data-value="magazines" data-search="Magazines" data-index="25">Magazine Subscriptions</li>
				<li data-value="misc" data-search="Miscellaneous" data-index="26">Miscellaneous</li>
				<li data-value="digital-music" data-search="MP3Downloads" data-index="27">MP3 Downloads</li>
				<li data-value="popular" data-search="Music" data-index="28">Music</li>
				<li data-value="mi" data-search="MusicalInstruments" data-index="29">Musical Instruments</li>
				<li data-value="office-products" data-search="OfficeProducts" data-index="30">Office Products</li>
				<li data-value="pets" data-search="PetSupplies" data-index="31">Pet Supplies</li>
				<li data-value="na-lawngarden-us" data-search="LawnAndGarden" data-index="32">Patio, Lawn &amp; Garden</li>
				<li data-value="shoes" data-search="Shoes" data-index="33">Shoes</li>
				<li data-value="software" data-search="Software" data-index="34">Software</li>
				<li data-value="na-collectibles-us" data-search="Collectibles" data-index="35">Sports Collectibles</li>
				<li data-value="sporting" data-search="SportingGoods" data-index="36">Sports &amp; Outdoors</li>
				<li data-value="tools" data-search="Tools" data-index="37">Tools &amp; Hardware</li>
				<li data-value="toys-and-games" data-search="Toys" data-index="38">Toys &amp; Games</li>
				<li data-value="vhs" data-search="VHS" data-index="39">VHS</li>
				<li data-value="videogames" data-search="VideoGames" data-index="40">Video Games</li>
				<li data-value="watches" data-search="Watches" data-index="41">Watches</li>
			</ul>
		</div>
		<div class="__ma-sw-suggestion-wrapper">
			<div style="padding: 0 15px; width: auto; border: none">
				<div class="__ma-sw-autcomplete"></div>
			</div>
		</div>
		<div style="display: none;">
			<form>
				<select class="__ma-sw-search-category">
					<option selected="selected" value="aps">Amazon.com</option>
					<option value="amazontv">Amazon Instant Video</option>
					<option value="apparel">Apparel &amp; Accessories</option>
					<option value="appliances">Appliances</option>
					<option value="arts-crafts">Arts, Crafts &amp; Sewing</option>
					<option value="automotive">Automotive</option>
					<option value="baby-products">Baby</option>
					<option value="beauty">Beauty</option>
					<option value="stripbooks">Books</option>
					<option value="photo">Camera &amp; Photo</option>
					<option value="mobile">Cell Phones &amp; Accessories</option>
					<option value="classical">Classical Music</option>
					<option value="pc-hardware">Computers</option>
					<option value="dvd">DVD</option>
					<option value="electronics">Electronics</option>
					<option value="na-collectibles-us">Entertainment Collectibles</option>
					<option value="videogames">Game Downloads</option>
					<option value="gift-cards">Gift Cards</option>
					<option value="grocery">Grocery &amp; Gourmet Food</option>
					<option value="garden">Home &amp; Garden</option>
					<option value="hpc">Health &amp; Personal Care</option>
					<option value="industrial">Industrial &amp; Scientific</option>
					<option value="jewelry">Jewelry</option>
					<option value="digital-text">Kindle Store</option>
					<option value="kitchen">Kitchen &amp; Housewares</option>
					<option value="magazines">Magazine Subscriptions</option>
					<option value="misc">Miscellaneous</option>
					<option value="digital-music">MP3 Downloads</option>
					<option value="popular">Music</option>
					<option value="mi">Musical Instruments</option>
					<option value="office-products">Office Products</option>
					<option value="pets">Pet Supplies</option>
					<option value="na-lawngarden-us">Patio, Lawn &amp; Garden</option>
					<option value="shoes">Shoes</option>
					<option value="software">Software</option>
					<option value="na-collectibles-us">Sports Collectibles</option>
					<option value="sporting">Sports &amp; Outdoors</option>
					<option value="tools">Tools &amp; Hardware</option>
					<option value="toys-and-games">Toys &amp; Games</option>
					<option value="vhs">VHS</option>
					<option value="videogames">Video Games</option>
					<option value="watches">Watches</option>
				</select> <select name="select2" class="__ma-sw-search-term">
					<option value="All">Amazon.com</option>
					<option value="UnboxVideo">Amazon Instant Video</option>
					<option value="Apparel">Apparel &amp; Accessories</option>
					<option value="Appliances">Appliances</option>
					<option value="ArtsAndCrafts">Arts, Crafts &amp; Sewing</option>
					<option value="Automotive">Automotive</option>
					<option value="Baby">Baby</option>
					<option value="Beauty">Beauty</option>
					<option value="Books">Books</option>
					<option value="Photo">Camera &amp; Photo</option>
					<option value="Wireless">Cell Phones &amp; Accessories</option>
					<option value="Classical">Classical Music</option>
					<option value="PCHardware">Computers</option>
					<option value="DVD">DVD</option>
					<option value="Electronics">Electronics</option>
					<option value="Collectibles">Entertainment Collectibles</option>
					<option value="VideoGames">Game Downloads</option>
					<option value="GiftCards">Gift Cards</option>
					<option value="Grocery">Grocery &amp; Gourmet Food</option>
					<option value="HomeGarden">Home &amp; Garden</option>
					<option value="HealthPersonalCare">Health &amp; Personal Care</option>
					<option value="Industrial">Industrial &amp; Scientific</option>
					<option value="Jewelry">Jewelry</option>
					<option value="KindleStore">Kindle Store</option>
					<option value="Kitchen">Kitchen &amp; Housewares</option>
					<option value="Magazines">Magazine Subscriptions</option>
					<option value="Miscellaneous">Miscellaneous</option>
					<option value="MP3Downloads">MP3 Downloads</option>
					<option value="Music">Music</option>
					<option value="MusicalInstruments">Musical Instruments</option>
					<option value="OfficeProducts">Office Products</option>
					<option value="PetSupplies">Pet Supplies</option>
					<option value="LawnAndGarden">Patio, Lawn &amp; Garden</option>
					<option value="Shoes">Shoes</option>
					<option value="Software">Software</option>
					<option value="Collectibles">Sports Collectibles</option>
					<option value="SportingGoods">Sports &amp; Outdoors</option>
					<option value="Tools">Tools &amp; Hardware</option>
					<option value="Toys">Toys &amp; Games</option>
					<option value="VHS">VHS</option>
					<option value="VideoGames">Video Games</option>
					<option value="Watches">Watches</option>
				</select>
			</form>
		</div>
		<iframe width="100%" height="253px" src="container.jsp" style="border: none;"></iframe>
	</div>
	<script type="text/javascript">
	(function(){
		var widget = document.getElementById("__mobileAssociatesSearchWidget_pl_test_tryitout_1");
		if(!widget) return;
		var defaultCategoryHTML = "";
		var defaultCategoryValue = "";
		var defaultCategorySearch = "";
		var createSearchBox = function(searchbox, width, height) {
			var iframe = document.createElement("iframe");
			iframe.setAttribute("width", (width+5)+"px");
			iframe.setAttribute("height", (height+5)+"px");
			iframe.style["border"] = "none";
			iframe.src = "http://singhpra-1.desktop.amazon.com:4000/widgets/q?ServiceVersion=20070822&MarketPlace=US&Operation="+ searchbox +"&TemplateId=SrchBox&region=US&marketplace=amazon&tracking_id=pbs-44&auto_complete=true";
			iframe.src += "&search_type=search_widget&width=auto&height=auto&link_id=junkLinkID&widgetId="+widget.getAttribute("id");
			iframe.src += "&theme=light&bg_color=FFF";
			widget.appendChild(iframe);
		};
		var createSearchWidget = function(width, height) {
			var iframe = document.createElement("iframe");
			iframe.setAttribute("width", "100%");
			iframe.setAttribute("height", "80px");
			iframe.style["border"] = "none";
			iframe.src = "http://singhpra-1.desktop.amazon.com:4000/widgets/q?ServiceVersion=20070822&MarketPlace=US&Operation=GetAdHtml&TemplateId=SrchWdgt&region=US&marketplace=amazon&tracking_id=pbs-44&auto_complete=true";
			iframe.src += "&search_type=search_widget&link_id=junkLinkID&width="+width+"&height="+height+"&default_search_category=Apparel&default_search_key=&widgetId="+widget.getAttribute("id");
			iframe.src += "&default_category_html="+defaultCategoryHTML+"&default_category_value="+defaultCategoryValue+"&default_category_search="+defaultCategorySearch;
			iframe.src += "&theme=light&bg_color=FFF";
			widget.appendChild(iframe);
		};
		var postToFrame = function(data) {
			var searchFrame = widget.getElementsByTagName("iframe");
			if(searchFrame && searchFrame[0] && searchFrame[0].contentWindow){
				searchFrame[0].contentWindow.postMessage(JSON.stringify(data), "*");
			}
		};
		function findMaxHeight(el) {
			do {
    			el = el.parentNode;
    			if (el.style && el.style.height) {
    				var height = parseInt(el.style.height);
    				if(isNaN(height) || height<=0) continue;
       				return height;
    			}
	  		} while (el.parentNode)
	  		return 80+(74*2)+24; // Default value, to display 2 result rows
		}
		{   //Populate the categories
			var default_category = "Apparel";
			var searchAlias = widget.getElementsByClassName("__ma-sw-search-term")[0].getElementsByTagName("option");
			var searchAliasMap = {};
			for(var i=0; i<searchAlias.length; i++) {
				searchAliasMap[searchAlias[i].innerHTML] = searchAlias[i].getAttribute("value"); 
			}
			var categories = widget.getElementsByClassName("__ma-sw-search-category")[0].getElementsByTagName("option");
			var list = widget.getElementsByClassName("__ma-sw-category-items")[0];
			var selectedCat = null;
			for(var i=0; i<categories.length; i++) {
				var item = document.createElement("li");
				item.innerHTML = categories[i].innerHTML;
				if(i==0) selectedCat = item;
				item.setAttribute("data-value", categories[i].getAttribute("value"));
				item.setAttribute("data-search", searchAliasMap[categories[i].innerHTML]);
				item.setAttribute("data-index", i);
				list.appendChild(item);
				if(searchAliasMap[categories[i].innerHTML] == default_category) {
					defaultCategoryHTML = categories[i].innerHTML.replace("&amp;", "and");
					defaultCategoryValue = categories[i].getAttribute("value");
					defaultCategorySearch = searchAliasMap[categories[i].innerHTML];
					selectedCat = item;
				}
			}
			selectedCat.setAttribute("class", "current");
			
			list.addEventListener("click", function(event){
				if(event.target && event.target.nodeName=="LI") {
					var lis = list.getElementsByTagName("li");
					for(var i=0; i<lis.length; i++) {
						lis[i].setAttribute("class", "");
						if(lis[i]==event.target)
							lis[i].setAttribute("class", "current");
					}
					postToFrame({
						operation: "selectCategory",
						html: event.target.innerHTML,
						value: event.target.getAttribute("data-value"),
						search: event.target.getAttribute("data-search")
					});
				}
			}, false);
		}
		{ // Decide the correct search widget
			/*var width = widget.clientWidth ? widget.clientWidth : widget.scrollWidth;
			var height = findMaxHeight(widget);
									if(width==160 && height==600) { 
				createSearchWidget(160, 600);
			} else if(width==320 && height==50) { 
				createSearchBox("GetSearchBox3", 300, 50);
			} else if(width>=245 && height>=80) {
				createSearchWidget(width, height);
			} else if(width>=180 && height>=150){
				createSearchBox("GetSearchBox2", 180, 150);
			} else if(width>=120 && height>=90) {
				createSearchBox("GetSearchBox1", 120, 90);
			} else {
				if(console && console.log)
					console.log("There is no sufficient area available to display Search Widget/Box (" + width+", " + height+")");
			}*/
		}
		{ //AutoComplete mouse events
			var autoCompleteDiv = widget.getElementsByClassName("__ma-sw-autcomplete")[0];
			autoCompleteDiv.addEventListener("mouseover", function(event){
				if(event.target.nodeName=="DIV" && event.target!=autoCompleteDiv){
					var selected = autoCompleteDiv.getElementsByClassName("__ma-sw-suggestion selected")[0];
					if(selected) selected.setAttribute("class", "__ma-sw-suggestion");
					event.target.setAttribute("class", "__ma-sw-suggestion selected");
				}
			}, false);
			autoCompleteDiv.addEventListener("click", function(event){
				if(event.target.nodeName=="DIV" || event.target.nodeName=="SPAN"){
					var selected = autoCompleteDiv.getElementsByClassName("__ma-sw-suggestion selected")[0];
					if(selected)
						postToFrame({
							"operation": "selectSuggestion",
							"text": selected.getAttribute("data-text"),
							"catValue": selected.getAttribute("data-cat-value"),
							"catSearch": selected.getAttribute("data-cat-search"),
							"catHTML": selected.getAttribute("data-cat-html"),
							"clicked": true
						});
					autoCompleteDiv.style["display"]="none";
				}
			}, false);
		}
		{ //Hiding Search suggestion and Category selection if clicked anywhere else
			var isFromSameDiv = function(node, target) {
				if(node==target) return true;
				while(target.parentNode) {
					target = target.parentNode;
					if(node==target) return true;		
				}
				return false;			
			};
			var autoCompleteDiv = widget.getElementsByClassName("__ma-sw-autcomplete")[0];
			var categories = widget.getElementsByClassName("__ma-sw-category-selection")[0];
			
			var ua = navigator.userAgent;
    		var fireEvent = (ua.match(/iPad|iPhone|iPod/i)) ? "touchstart" : "click";
			window.addEventListener(fireEvent, function(event){
				if(event.target) {
					if(autoCompleteDiv.style["display"]!="none" && !isFromSameDiv(autoCompleteDiv, event.target)) {
						autoCompleteDiv.style["display"]="none";
					}
					if(categories.style["display"]!="none" && !isFromSameDiv(categories, event.target)) {
						postToFrame({"operation" : "hideCategoriesInSrchWidget"});
					}
					if(fireEvent == "touchstart")
						postToFrame({"operation" : "loseFocus"});
				}
			});
		}
	}());
	if(!window.__maSwMainListener) { //This is a global function
		window.__maSwMainListener = function(event) {
		
			if(!event.data) return;
			//if(!(event.origin && event.origin=="http://singhpra-1.desktop.amazon.com:4000")) return;
			var mydata = JSON.parse(event.data);
			if(!(mydata && mydata.widgetId && mydata.operation)) return;
			
			var myWidget = document.getElementById(mydata.widgetId); if(!myWidget) return;
			var postToFrame = function(data) {
				myWidget.getElementsByTagName("iframe")[0].contentWindow.postMessage(JSON.stringify(data), "*");
			};
			if(mydata.operation=="showCategory") {
				myWidget.getElementsByClassName("__ma-sw-category-selection")[0].style["display"] = "block";
			} else if (mydata.operation=="hideCategory") {
				myWidget.getElementsByClassName("__ma-sw-category-selection")[0].style["display"] = "none";
			} else if(mydata.operation=="resizeAd") {
				myWidget.getElementsByTagName("iframe")[0].setAttribute("height", (mydata.height+5) + "px");
			} else if(mydata.operation == "showSuggestion") {
				var autoCompleteDiv = myWidget.getElementsByClassName("__ma-sw-autcomplete")[0];
				autoCompleteDiv.innerHTML = "";
				var categoryList = myWidget.getElementsByClassName("__ma-sw-category-items")[0];
				var hightLightedCat = categoryList.getElementsByClassName("current")[0];
				var counter = 0;
				if(mydata.suggestion)
					for(var i=0; i<mydata.suggestion.length && i<6; i++) {
						var sugg = document.createElement("div");
						sugg.setAttribute("class", "__ma-sw-suggestion");
						sugg.setAttribute("data-index", counter++);
						sugg.setAttribute("data-text", mydata.suggestion[i]);
						sugg.setAttribute("data-cat-value", hightLightedCat.getAttribute("data-value"));
						sugg.setAttribute("data-cat-search", hightLightedCat.getAttribute("data-search"));
						sugg.setAttribute("data-cat-html", hightLightedCat.innerHTML);
						sugg.innerHTML = mydata.suggestion[i];
						autoCompleteDiv.appendChild(sugg);
						
						if(document.querySelector && mydata.category[i] && mydata.category[i].nodes) {
							var cat = mydata.category[i].nodes;
							for(var j=0; j<cat.length; j++) {
								var selectedCat = myWidget.querySelector("ul.__ma-sw-category-items > li[data-value=" + cat[j].alias + "]");
								if(selectedCat) {
									var suggWithCat = document.createElement("div");
									suggWithCat.setAttribute("class", "__ma-sw-suggestion");
									suggWithCat.setAttribute("data-index", counter++);
									suggWithCat.setAttribute("data-text", mydata.suggestion[i]);
									suggWithCat.setAttribute("data-cat-value", selectedCat.getAttribute("data-value"));
									suggWithCat.setAttribute("data-cat-search", selectedCat.getAttribute("data-search"));
									suggWithCat.setAttribute("data-cat-html", selectedCat.innerHTML);
									suggWithCat.innerHTML = mydata.suggestion[i] + "<span class=\"cat-wrapper\"> in " + cat[j].name + "</span>"; 
									autoCompleteDiv.appendChild(suggWithCat);
								}
							}
						}
					}
				autoCompleteDiv.style["display"] = "block";
			} else if(mydata.operation == "hideSuggestion") {
				myWidget.getElementsByClassName("__ma-sw-autcomplete")[0].style["display"] = "none";
			} else if(mydata.operation == "selectSuggestion") {
				var autoCompleteDiv = myWidget.getElementsByClassName("__ma-sw-autcomplete")[0];
				if(autoCompleteDiv.style["display"]=="none") return;
				
				var selected = autoCompleteDiv.getElementsByClassName("__ma-sw-suggestion selected")[0];
				var allItems = autoCompleteDiv.getElementsByClassName("__ma-sw-suggestion");
				if(!allItems) return;
				if(mydata.key=="DOWN") {
					if(!selected) {
						allItems[0].setAttribute("class", "__ma-sw-suggestion selected");
						postToFrame({
							"operation": "selectSuggestion",
							"text": allItems[0].getAttribute("data-text"),
							"catValue": allItems[0].getAttribute("data-cat-value"),
							"catSearch": allItems[0].getAttribute("data-cat-search"),
							"catHTML": allItems[0].getAttribute("data-cat-html")
						});
					} else {
						var selectedIndex = parseInt(selected.getAttribute("data-index")); 
						if(selectedIndex==(allItems.length-1)) return;
						selected.setAttribute("class", "__ma-sw-suggestion");
						selectedIndex++;
						allItems[selectedIndex].setAttribute("class", "__ma-sw-suggestion selected");
						postToFrame({
							"operation": "selectSuggestion",
							"text": allItems[selectedIndex].getAttribute("data-text"),
							"catValue": allItems[selectedIndex].getAttribute("data-cat-value"),
							"catSearch": allItems[selectedIndex].getAttribute("data-cat-search"),
							"catHTML": allItems[selectedIndex].getAttribute("data-cat-html")
						});
					}
				} else if(mydata.key=="UP") {
					if(!selected) return;
					var selectedIndex = parseInt(selected.getAttribute("data-index"));
					selected.setAttribute("class", "__ma-sw-suggestion");
					postToFrame({
						"operation": "selectSuggestion",
						"text": mydata.oldValue
					});
					selectedIndex--;
					if(selectedIndex>=0) {
						allItems[selectedIndex].setAttribute("class", "__ma-sw-suggestion selected");
						postToFrame({
							"operation": "selectSuggestion",
							"text": allItems[selectedIndex].getAttribute("data-text"),
							"catValue": allItems[selectedIndex].getAttribute("data-cat-value"),
							"catSearch": allItems[selectedIndex].getAttribute("data-cat-search"),
							"catHTML": allItems[selectedIndex].getAttribute("data-cat-html")
						});
					}				
				}
			} else if(mydata.operation == "keyPressCategory") {
				if(mydata.key == 27) {  //ESC key
					postToFrame({"operation" : "hideCategoriesInSrchWidget"});
					return;
				}
				var categoryList = myWidget.getElementsByClassName("__ma-sw-category-items")[0];
				var selectedItem = categoryList.getElementsByClassName("outline")[0] || categoryList.getElementsByClassName("current")[0];
				if(mydata.key==13 || mydata.key==9) { // ENTER Key, TAB key
					if(selectedItem) {
						postToFrame({
							operation: "selectCategory",
							html: selectedItem.innerHTML,
							value: selectedItem.getAttribute("data-value"),
							search: selectedItem.getAttribute("data-search")
						});
						selectedItem.setAttribute("class", "current");
					}
					else
						postToFrame({"operation" : "hideCategoriesInSrchWidget"});
					return;
				}
				var current = categoryList.getElementsByClassName("current")[0];
				if(current) current.removeAttribute("class");
				
				var allItems = categoryList.getElementsByTagName("li");
				var categoryBoundry = categoryList.getBoundingClientRect();
				if(selectedItem) {
					var curIndex = selectedItem.getAttribute("data-index");
					if(mydata.key==40) { //DOWN key
						if(curIndex < (allItems.length-1)) {
							selectedItem.removeAttribute("class");
							curIndex++;
							selectedItem = allItems[curIndex];
							selectedItem.setAttribute("class", "outline");
						}
					} else if(mydata.key==38) { //UP key
						if(curIndex > 0) {
							selectedItem.removeAttribute("class");
							curIndex--;
							selectedItem = allItems[curIndex];
							selectedItem.setAttribute("class", "outline");
						}
					}
					var bound = selectedItem.getBoundingClientRect();
					if(bound.bottom - categoryBoundry.bottom > 0)
						categoryList.scrollTop += bound.bottom - categoryBoundry.bottom;
					else if(categoryBoundry.top - bound.top > 0){
						categoryList.scrollTop -= (categoryBoundry.top - bound.top);
					}	
				} else if(!selectedItem && mydata.key==40) {
					for(var i=0; i<allItems.length; i++) {
						var bound = allItems[i].getBoundingClientRect();
						if(bound.top - categoryBoundry.top >= 0) {
							allItems[i].setAttribute("class", "outline");
							break;
						}
					}
				}
			} else if(mydata.operation == "updateCategory" && document.querySelector) { 
				var newCat = myWidget.querySelector("ul.__ma-sw-category-items > li[data-value=" + mydata.catValue + "]");
				var oldCat = myWidget.querySelector("ul.__ma-sw-category-items > li.current");
				if(oldCat && newCat) {
					oldCat.setAttribute("class", "");
					newCat.setAttribute("class", "current");						
				}
			} else if(mydata.operation == "findCategory" && document.querySelector && mydata.key) { 
				var categories = myWidget.querySelectorAll("ul.__ma-sw-category-items > li");
				for(var i=0; i<categories.length; i++) {
					var cat = categories[i].innerHTML.toLowerCase();
					if(cat==mydata.key) {
						postToFrame({
							operation: "selectCategory",
							html: categories[i].innerHTML,
							value: categories[i].getAttribute("data-value"),
							search: categories[i].getAttribute("data-search")
						});
						break;
					}
				}
			}
		};
		window.addEventListener("message", window.__maSwMainListener, false);
	}
	</script>
</div>
